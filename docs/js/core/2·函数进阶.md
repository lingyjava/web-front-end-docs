# 2·函数进阶

- [2·函数进阶](#2函数进阶)
  - [函数定义和调用](#函数定义和调用)
  - [this 指向](#this-指向)
    - [改变指向](#改变指向)
  - [严格模式](#严格模式)
  - [高阶函数](#高阶函数)
  - [闭包](#闭包)
  - [递归](#递归)
  - [浅拷贝和深拷贝](#浅拷贝和深拷贝)


## 函数定义和调用

所有函数都是 Function 对象的实例。

函数的定义方式：

- 使用 function 关键字方式声明命名函数。
- 函数表达式（匿名函数）。
- `var fn = new Function('参数1','参数2'..., '函数体'')`，执行效率低，较少使用。
  - 参数都必须是字符串格式。

## this 指向

 this 的指向是当调用函数时确定的，调用方式的不同决定了 this 的指向不同。

### 改变指向

call() 方法调用一个对象。简单理解为调用函数的方式，可以改变函数的 this 指向。

`fun.call(thisArg, arg1, arg2, ...) `

- thisArg：在 fun 函数运行时指定的 this 值。
- arg1，arg2：传递的其他参数。
- 返回值就是函数的返回值，因为它就是调用函数。
- 想改变 this 指向，同时想调用这个函数时，可以使用 call，比如继承。

---

apply() 方法调用一个函数。简单理解为调用函数的方式，可以改变函数的 this 指向。

`fun.apply(thisArg, [argsArray])`

- thisArg：在fun函数运行时指定的 this 值。
- argsArray：传递的值，必须包含在数组里面。
- 返回值就是函数的返回值，因为它就是调用函数。
- 因此 apply 主要跟数组有关系，比如使用 Math.max() 求数组的最大值。

---

bind() 方法不会调用函数。能改变函数内部 this 指向。

`fun.bind(thisArg, arg1, arg2, ...)`

- thisArg：在 fun 函数运行时指定的 this 值。
- arg1，arg2：传递的其他参数。
- 返回由指定的 this 值和初始化参数改造的原函数拷贝。
- 当只是想改变 this 指向，并且不想调用这个函数时，使用 bind.

## 严格模式

JavaScript 除了提供正常模式外，还提供了严格模式（strict mode）。即在严格的条件下运行 JS 代码。

严格模式在 IE10 以上版本的浏览器中才会被支持，旧版本浏览器中会被忽略。

---

严格模式对正常的 JavaScript 语义做了一些更改：

- 消除了 Javascript 语法的一些不合理、不严谨之处，减少了一些怪异行为。
- 消除代码运行的一些不安全之处，保证代码运行的安全。
- 提高编译器效率，增加运行速度。
- 禁用了在 ECMAScript 的未来版本中可能会定义的一些语法，为未来新版本的 Javascript 做好铺垫。

---

严格模式可以应用到整个脚本或个别函数中。因此在使用时，我们可以将严格模式分为为脚本开启严格模式和 为函数开启严格模式两种情况。

为整个脚本文件开启严格模式，需要在所有语句之前放一个特定语句 `"use strict"` 或 `'use strict'`。

要给某个函数开启严格模式，把 `"use strict"` 或 `'use strict'`声明放在函数体所有语句之前。

老版本的浏览器会把它当作一行普通字符串而忽略。

---

严格模式变化：

- 在正常模式中，如果一个变量没有声明就赋值，默认是全局变量。严格模式禁止这种用法，变量都必须先用 var 命令声明，然后再使用。
- 严禁删除已经声明变量，`delete x` 语法是错误的。
- 函数不能有重名的参数。
- 函数必须声明在顶层，不允许在非函数的代码块内声明函数。ES6 中会引入块级作用域，为了与新版本接轨。
- 严格模式下全局作用域中函数中的 this 指向是 undefined.

[更多规则](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Strict_mode)

## 高阶函数

高阶函数是对其他函数进行操作的函数，它接收函数作为参数或将函数作为返回值输出。

```js
// 接收函数作为参数
function fn(callback) {
    callback&&callback()
}
fn(function(){
    console.log('hi')
})

// 将函数作为返回值输出
function fn2(){
    return function() {
        console.log('hi 2')
    }
}
fn2()();
```

函数也是一种数据类型，可以作为参数传递给另外一个参数使用。典型的就是作为回调函数。 函数也可以作为返回值传递回来。

## 闭包

闭包（closure）指有权访问另一个函数作用域中变量的函数。

即一个作用域可以访问另外一个函数内部的局部变量。

目的是为了延伸变量的作用范围。

```js
// 闭包函数
function fn1() { 
    var num = 10
    function fn2(){
        console.log(num) // 10
    }
    fn2()
}
fn1()
```

## 递归

函数在内部可以调用本身，这个函数就是递归函数。

必须要加退出条件 return.

由于递归容易发生“栈溢出”错误（stack overflow），需要根据实际情况使用。

## 浅拷贝和深拷贝

浅拷贝只是拷贝一层，对象级别的只拷贝引用。

深拷贝拷贝多层，每一级别的数据都会拷贝。

---

ES6 新增浅拷贝方法：

`Object.assign(target, ...sources)`